## Operator installer README

This document explains how to use the Operator installer (deployment script).

### Pre-reqs

* a running OpenShift or link:https://docs.okd.io/latest/minishift/index.html[Minishift] instance
* an active session (you should be logged in)
* cluster-admin privileges to register CRD and grant Operator service account cluster admin permissions
```
oc login --server=https://your.ip.address.here:8443 -u developer -p developer
```

### Quickstart

The simplest way to run the script is to use all the defaults.

The following command will grab config from codeready-cr.yaml and start an installer image:

```
./deploy.sh --deploy
```

### Installation Configuration

The installer script will use command line args and `codeready-cr.yaml` file to populate Operator CR spec fields.

#### Configuration

You can override default envs. Not all configuration parameters are available as flags. Run `./deploy.sh --help` to get a list of all available arguments.

`codeready-cr.yaml` is a template with CR object holding spec fields that instruct the Operator on how exactly to deploy CodeReady Workspace.

#### Examples

##### Deploy with all defaults

The following command will grab config from config.yaml and start an installer image:

```
./deploy.sh --deploy
```
Specify a project/namespace:

```
./deploy.sh --deploy -p=mynamespace
```

#### Deploy without support of self signed certs, OpenShift OAuth and a custom server-image

```
./deploy.sh --deploy --server-image=myserver/image --version=latest -public-certs
```

##### Deploy with external Red Hat SSO:

In `codeready-cr.yaml`:

```
externalKeycloak: true
keycloakURL: 'https://my-keycloak.com'
keycloakRealm: 'myrealm'
keycloakClientId: 'myClient'

```

##### Deploy with external Red Hat SSO and Postgres DB:

In `codeready-cr.yaml`:

```
externalDb: true
chePostgresHostname: 'http://postgres'
chePostgresPort: '5432'
chePostgresUser: 'myuser'
chePostgresPassword: 'mypass'
chePostgresDb: 'mydb'

....
externalKeycloak: true
keycloakURL: 'https://my-keycloak.com'
keycloakRealm: 'myrealm'
keycloakClientId: 'myClient'
```

### External DB and RH SSO Support

You can connect to external DB and RH SSO instances. The installer supports the following combinations:

* DB + RH SSO
* RH SSO alone

External DB + bundled RH SSO isn't currently supported. Provisioning of database and Keycloak realm and client happens only with bundled resources,
i.e. if you are connecting your own DB or Keycloak you need to pre-create resources. Refer to installation docs for more details.
